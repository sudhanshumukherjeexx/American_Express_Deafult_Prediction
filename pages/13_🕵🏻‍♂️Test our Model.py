import streamlit as st
import pandas as pd
from catboost import CatBoostClassifier
from sklearn.preprocessing import LabelEncoder
import gc; gc.enable()
from xgboost import XGBClassifier


st.image("4.png", output_format="auto")
st.title("American Express Fraud Detection")

data = st.session_state['data']

_ = gc.collect()

CatBoostmodel = CatBoostClassifier()
CatBoostmodel.load_model('CatBoost.json')

XGBoostmodel = XGBClassifier()
XGBoostmodel.load_model('XGBoost.json') 


cat_features = ["S_2","B_30", "B_38",'D_114','D_116','D_117','D_120','D_126','D_63','D_64','D_66','D_68']

le_encoder = LabelEncoder()
for categorical_feature in cat_features:
    data[categorical_feature] = le_encoder.fit_transform(data[categorical_feature])


st.title("Fraud Classifer")
st.header("Select Feature Values for this Transaction")



S_2 = st.slider("S_2", min_value=0 , max_value=395)
P_2 = st.slider("P_2", min_value=-0.4589548408985138 , max_value=1.0099999904632568)
D_39 = st.slider("D_39", min_value=0 , max_value=183)
B_1 = st.slider("B_1", min_value=-7.588798999786377 , max_value=1.3240604400634766)
B_2 = st.slider("B_2", min_value=9.19227982620896e-09 , max_value=1.0099999904632568)
R_1 = st.slider("R_1", min_value=1.5342229708892319e-09 , max_value=3.256284475326538)
S_3 = st.slider("S_3", min_value=-0.6271320581436157 , max_value=5.482888221740723)
D_41 = st.slider("D_41", min_value=0.0 , max_value=8.98880672454834)
B_3 = st.slider("B_3", min_value=6.285293174812523e-09 , max_value=1.6252622604370117)
D_43 = st.slider("D_43", min_value=1.154549806869909e-07 , max_value=10.111618995666504)
D_44 = st.slider("D_44", min_value=-1 , max_value=45)
B_4 = st.slider("B_4", min_value=0 , max_value=1544)
D_45 = st.slider("D_45", min_value=1.5632410921284645e-08 , max_value=1.610002040863037)
B_5 = st.slider("B_5", min_value=2.8048216527132297e-11 , max_value=144.20701599121094)
R_2 = st.slider("R_2", min_value=0 , max_value=1)
D_46 = st.slider("D_46", min_value=-17.289342880249023 , max_value=16.319900512695312)
D_47 = st.slider("D_47", min_value=-0.026621641591191292 , max_value=1.6430962085723877)
D_48 = st.slider("D_48", min_value=-0.00961527694016695 , max_value=8.97142505645752)
D_49 = st.slider("D_49", min_value=-1 , max_value=3254)
B_6 = st.slider("B_6", min_value=-0.005178168416023254 , max_value=1214.5169677734375)
B_7 = st.slider("B_7", min_value=-2.6527485847473145 , max_value=1.2527501583099365)
B_8 = st.slider("B_8", min_value=0.0 , max_value=1.0190789699554443)
D_50 = st.slider("D_50", min_value=-306.487060546875 , max_value=244.04266357421875)
D_51 = st.slider("D_51", min_value=0 , max_value=8)
B_9 = st.slider("B_9", min_value=6.726069923246314e-09 , max_value=27.42485809326172)
R_3 = st.slider("R_3", min_value=0 , max_value=116)
D_52 = st.slider("D_52", min_value=-0.007083109579980373 , max_value=1.0099999904632568)
P_3 = st.slider("P_3", min_value=-1.519689679145813 , max_value=2.428050994873047)
B_10 = st.slider("B_10", min_value=-0.0029584814328700304 , max_value=4097.44091796875)
D_53 = st.slider("D_53", min_value=5.678128900399315e-08 , max_value=7.9019389152526855)
S_5 = st.slider("S_5", min_value=8.168134613129041e-09 , max_value=206.87527465820312)
B_11 = st.slider("B_11", min_value=2.0178136495019316e-08 , max_value=1.9703748226165771)
S_6 = st.slider("S_6", min_value=0 , max_value=1)
D_54 = st.slider("D_54", min_value=-0.002005766611546278 , max_value=1.0)
R_4 = st.slider("R_4", min_value=0 , max_value=1)
S_7 = st.slider("S_7", min_value=-0.4701317548751831 , max_value=3.9482712745666504)
B_12 = st.slider("B_12", min_value=3.343623689033848e-08 , max_value=420.7489929199219)
S_8 = st.slider("S_8", min_value=0 , max_value=3867)
D_55 = st.slider("D_55", min_value=2.3532178872187615e-08 , max_value=2.767758846282959)
D_56 = st.slider("D_56", min_value=-0.017089147120714188 , max_value=10.956514358520508)
B_13 = st.slider("B_13", min_value=1.9058504108215857e-08 , max_value=276.1778259277344)
R_5 = st.slider("R_5", min_value=0 , max_value=70)
D_58 = st.slider("D_58", min_value=4.96894525525704e-09 , max_value=1.261945128440857)
S_9 = st.slider("S_9", min_value=2.8234981641617196e-07 , max_value=2.839634656906128)
B_14 = st.slider("B_14", min_value=-8.469853401184082 , max_value=55.01151657104492)
D_59 = st.slider("D_59", min_value=-1 , max_value=108)
D_60 = st.slider("D_60", min_value=5.905030242558951e-09 , max_value=1.0099999904632568)
D_61 = st.slider("D_61", min_value=-0.009259018115699291 , max_value=868.5154418945312)
B_15 = st.slider("B_15", min_value=-10.008048057556152 , max_value=65.03742980957031)
S_11 = st.slider("S_11", min_value=0 , max_value=100)
D_62 = st.slider("D_62", min_value=-0.002822134643793106 , max_value=11.100953102111816)
D_63 = st.slider("D_63", min_value=0 , max_value=5)
D_64 = st.slider("D_64", min_value=-1 , max_value=3)
D_65 = st.slider("D_65", min_value=0 , max_value=14664)
B_16 = st.slider("B_16", min_value=-1 , max_value=12)
B_17 = st.slider("B_17", min_value=3.774555068503105e-08 , max_value=1.0099999904632568)
B_18 = st.slider("B_18", min_value=5.891221732667873e-08 , max_value=1.0)
B_19 = st.slider("B_19", min_value=-1 , max_value=100)
D_66 = st.slider("D_66", min_value=-1 , max_value=1)
B_20 = st.slider("B_20", min_value=-1 , max_value=17)
D_68 = st.slider("D_68", min_value=-1 , max_value=6)
S_12 = st.slider("S_12", min_value=-0.4041089713573456 , max_value=175.3314208984375)
R_6 = st.slider("R_6", min_value=4.6506809514568204e-10 , max_value=14.448201179504395)
S_13 = st.slider("S_13", min_value=0 , max_value=1034)
B_21 = st.slider("B_21", min_value=4.42675274214821e-09 , max_value=288.2942810058594)
D_69 = st.slider("D_69", min_value=6.051600998091544e-09 , max_value=13000.9091796875)
B_22 = st.slider("B_22", min_value=-1 , max_value=7)
D_70 = st.slider("D_70", min_value=-1 , max_value=28)
D_71 = st.slider("D_71", min_value=3.0269393658244326e-09 , max_value=67.03231048583984)
D_72 = st.slider("D_72", min_value=-1 , max_value=9)
S_15 = st.slider("S_15", min_value=0 , max_value=56)
B_23 = st.slider("B_23", min_value=4.3529627902216816e-08 , max_value=1.6930979490280151)
P_4 = st.slider("P_4", min_value=0.0 , max_value=1.269390344619751)
D_74 = st.slider("D_74", min_value=-1 , max_value=63)
D_75 = st.slider("D_75", min_value=0 , max_value=64)
B_24 = st.slider("B_24", min_value=1.8209389551770983e-09 , max_value=46.60664749145508)
R_7 = st.slider("R_7", min_value=0.0 , max_value=449.9888916015625)
D_77 = st.slider("D_77", min_value=2.6787139617567846e-08 , max_value=10.229169845581055)
B_25 = st.slider("B_25", min_value=-11.25357723236084 , max_value=15.699758529663086)
B_26 = st.slider("B_26", min_value=1.691720985519396e-09 , max_value=1499.2203369140625)
D_78 = st.slider("D_78", min_value=-1 , max_value=32)
D_79 = st.slider("D_79", min_value=-1 , max_value=36)
R_8 = st.slider("R_8", min_value=0 , max_value=38)
R_9 = st.slider("R_9", min_value=-1 , max_value=9)
S_16 = st.slider("S_16", min_value=5.083304444042369e-09 , max_value=231.75894165039062)
D_80 = st.slider("D_80", min_value=-1 , max_value=40)
R_10 = st.slider("R_10", min_value=0 , max_value=21)
R_11 = st.slider("R_11", min_value=0 , max_value=25)
B_27 = st.slider("B_27", min_value=1.0441589815002317e-09 , max_value=1.0053701400756836)
D_81 = st.slider("D_81", min_value=-1 , max_value=8)
D_82 = st.slider("D_82", min_value=-1 , max_value=6)
S_17 = st.slider("S_17", min_value=1.0198056843435666e-09 , max_value=4.049070358276367)
R_12 = st.slider("R_12", min_value=-0.0917934700846672 , max_value=1.0)
B_28 = st.slider("B_28", min_value=-2.160207077395171e-05 , max_value=25.53337287902832)
R_13 = st.slider("R_13", min_value=0 , max_value=31)
D_83 = st.slider("D_83", min_value=-1 , max_value=38)
R_14 = st.slider("R_14", min_value=0.0 , max_value=4837.3046875)
R_15 = st.slider("R_15", min_value=0 , max_value=1)
D_84 = st.slider("D_84", min_value=-1 , max_value=58)
R_16 = st.slider("R_16", min_value=0 , max_value=37)
B_30 = st.slider("B_30", min_value=-1 , max_value=2)
S_18 = st.slider("S_18", min_value=0 , max_value=1)
D_86 = st.slider("D_86", min_value=0 , max_value=1)
D_87 = st.slider("D_87", min_value=-1 , max_value=1)
R_17 = st.slider("R_17", min_value=0 , max_value=35)
R_18 = st.slider("R_18", min_value=0 , max_value=31)
B_31 = st.slider("B_31", min_value=0 , max_value=1)
S_19 = st.slider("S_19", min_value=3.156390260272701e-09 , max_value=1.0)
R_19 = st.slider("R_19", min_value=0 , max_value=1)
B_32 = st.slider("B_32", min_value=0 , max_value=1)
S_20 = st.slider("S_20", min_value=0 , max_value=1)
R_20 = st.slider("R_20", min_value=-1 , max_value=45)
R_21 = st.slider("R_21", min_value=0 , max_value=1)
B_33 = st.slider("B_33", min_value=-1 , max_value=1)
D_89 = st.slider("D_89", min_value=-1 , max_value=9)
R_22 = st.slider("R_22", min_value=0 , max_value=1)
R_23 = st.slider("R_23", min_value=0 , max_value=1)
D_91 = st.slider("D_91", min_value=-1 , max_value=6)
D_92 = st.slider("D_92", min_value=0 , max_value=2)
D_93 = st.slider("D_93", min_value=0 , max_value=1)
D_94 = st.slider("D_94", min_value=0 , max_value=1)
R_24 = st.slider("R_24", min_value=0 , max_value=1)
R_25 = st.slider("R_25", min_value=0 , max_value=1)
D_96 = st.slider("D_96", min_value=0 , max_value=1)
S_22 = st.slider("S_22", min_value=-91.99815368652344 , max_value=1.0327266454696655)
S_23 = st.slider("S_23", min_value=-206.08546447753906 , max_value=885.3348999023438)
S_24 = st.slider("S_24", min_value=-90.48382568359375 , max_value=1.0556379556655884)
S_25 = st.slider("S_25", min_value=-2.4534506797790527 , max_value=4.0520477294921875)
S_26 = st.slider("S_26", min_value=5.137101410923606e-09 , max_value=136.66598510742188)
D_102 = st.slider("D_102", min_value=9.620586549630161e-10 , max_value=1.0899981260299683)
D_103 = st.slider("D_103", min_value=-1 , max_value=1)
D_104 = st.slider("D_104", min_value=0.0 , max_value=1.302976131439209)
D_105 = st.slider("D_105", min_value=-0.026404818519949913 , max_value=5.63173246383667)
D_106 = st.slider("D_106", min_value=-1 , max_value=14417)
D_107 = st.slider("D_107", min_value=-1 , max_value=21)
B_36 = st.slider("B_36", min_value=1.160855522819304e-09 , max_value=1.0)
B_37 = st.slider("B_37", min_value=-7.604272842407227 , max_value=1.3278119564056396)
R_26 = st.slider("R_26", min_value=-1 , max_value=266)
R_27 = st.slider("R_27", min_value=-0.025710992515087128 , max_value=1.0099999904632568)
B_38 = st.slider("B_38", min_value=-1 , max_value=7)
D_108 = st.slider("D_108", min_value=-1 , max_value=9)
D_109 = st.slider("D_109", min_value=-1 , max_value=1)
D_111 = st.slider("D_111", min_value=-1 , max_value=2)
D_112 = st.slider("D_112", min_value=4.344639847886356e-08 , max_value=1.0)
B_40 = st.slider("B_40", min_value=1.2012753458634506e-08 , max_value=5755.076171875)
S_27 = st.slider("S_27", min_value=4.417077259510904e-10 , max_value=5.456268787384033)
D_113 = st.slider("D_113", min_value=-1 , max_value=125)
D_114 = st.slider("D_114", min_value=-1 , max_value=1)
D_115 = st.slider("D_115", min_value=2.2280535461050022e-07 , max_value=1.9995397329330444)
D_116 = st.slider("D_116", min_value=-1 , max_value=1)
D_117 = st.slider("D_117", min_value=-1 , max_value=7)
D_118 = st.slider("D_118", min_value=2.5519062418766225e-08 , max_value=1.97090744972229)
D_119 = st.slider("D_119", min_value=7.07670864130705e-08 , max_value=1.9770066738128662)
D_120 = st.slider("D_120", min_value=-1 , max_value=1)
D_121 = st.slider("D_121", min_value=-0.03207546845078468 , max_value=1.7911148071289062)
D_122 = st.slider("D_122", min_value=-1 , max_value=14)
D_123 = st.slider("D_123", min_value=-1 , max_value=104)
D_124 = st.slider("D_124", min_value=-1 , max_value=201)
D_125 = st.slider("D_125", min_value=-1 , max_value=14)
D_126 = st.slider("D_126", min_value=-1 , max_value=2)
D_127 = st.slider("D_127", min_value=0 , max_value=1)
D_128 = st.slider("D_128", min_value=0.0 , max_value=1.023471713066101)
D_129 = st.slider("D_129", min_value=-1 , max_value=1)
B_41 = st.slider("B_41", min_value=-1 , max_value=22)
D_130 = st.slider("D_130", min_value=0.0 , max_value=1.0280444622039795)
D_131 = st.slider("D_131", min_value=0.0 , max_value=1.491623878479004)
D_133 = st.slider("D_133", min_value=6.380582173726168e-10 , max_value=1.5099995136260986)
R_28 = st.slider("R_28", min_value=0 , max_value=1)
D_135 = st.slider("D_135", min_value=-1 , max_value=1)
D_136 = st.slider("D_136", min_value=-1 , max_value=7)
D_137 = st.slider("D_137", min_value=-1 , max_value=1)
D_138 = st.slider("D_138", min_value=-1 , max_value=6)
D_139 = st.slider("D_139", min_value=-1 , max_value=1)
D_140 = st.slider("D_140", min_value=-1 , max_value=1)
D_141 = st.slider("D_141", min_value=0.0 , max_value=1.3399103879928589)
D_143 = st.slider("D_143", min_value=-1 , max_value=1)
D_144 = st.slider("D_144", min_value=2.500990525788893e-09 , max_value=1.343330979347229)
D_145 = st.slider("D_145", min_value=-1 , max_value=53)


values = pd.DataFrame([[S_2,P_2, D_39, B_1, B_2, R_1, S_3, D_41, B_3, D_43, D_44, B_4, D_45, B_5, R_2, D_46, D_47, D_48, D_49, B_6, B_7, B_8, D_50, D_51, B_9, R_3, D_52, P_3, B_10, D_53, S_5, B_11, S_6, D_54, R_4, S_7, B_12, S_8, D_55, D_56, B_13, R_5, D_58, S_9, B_14, D_59, D_60, D_61, B_15, S_11, D_62, D_63, D_64, D_65, B_16, B_17, B_18, B_19, D_66, B_20, D_68, S_12, R_6, S_13, B_21, D_69, B_22, D_70, D_71, D_72, S_15, B_23, P_4, D_74, D_75, B_24, R_7, D_77, B_25, B_26, D_78, D_79, R_8, R_9, S_16, D_80, R_10, R_11, B_27, D_81, D_82, S_17, R_12, B_28, R_13, D_83, R_14, R_15, D_84, R_16, B_30, S_18, D_86, D_87, R_17, R_18, B_31, S_19, R_19, B_32, S_20, R_20, R_21, B_33, D_89, R_22, R_23, D_91, D_92, D_93, D_94, R_24, R_25, D_96, S_22, S_23, S_24, S_25, S_26, D_102, D_103, D_104, D_105, D_106, D_107, B_36, B_37, R_26, R_27, B_38, D_108, D_109, D_111, D_112, B_40, S_27, D_113, D_114, D_115, D_116, D_117, D_118, D_119, D_120, D_121, D_122, D_123, D_124, D_125, D_126, D_127, D_128, D_129, B_41, D_130, D_131, D_133, R_28, D_135, D_136, D_137, D_138, D_139, D_140, D_141, D_143, D_144, D_145]], columns=['S_2','P_2', 'D_39', 'B_1', 'B_2', 'R_1', 'S_3', 'D_41', 'B_3', 'D_43', 'D_44', 'B_4', 'D_45', 'B_5', 'R_2', 'D_46', 'D_47', 'D_48', 'D_49', 'B_6', 'B_7', 'B_8', 'D_50', 'D_51', 'B_9', 'R_3', 'D_52', 'P_3', 'B_10', 'D_53', 'S_5', 'B_11', 'S_6', 'D_54', 'R_4', 'S_7', 'B_12', 'S_8', 'D_55', 'D_56', 'B_13', 'R_5', 'D_58', 'S_9', 'B_14', 'D_59', 'D_60', 'D_61', 'B_15', 'S_11', 'D_62', 'D_63', 'D_64', 'D_65', 'B_16', 'B_17', 'B_18', 'B_19', 'D_66', 'B_20', 'D_68', 'S_12', 'R_6', 'S_13', 'B_21', 'D_69', 'B_22', 'D_70', 'D_71', 'D_72', 'S_15', 'B_23', 'P_4', 'D_74', 'D_75', 'B_24', 'R_7', 'D_77', 'B_25', 'B_26', 'D_78', 'D_79', 'R_8', 'R_9', 'S_16', 'D_80', 'R_10', 'R_11', 'B_27', 'D_81', 'D_82', 'S_17', 'R_12', 'B_28', 'R_13', 'D_83', 'R_14', 'R_15', 'D_84', 'R_16', 'B_30', 'S_18', 'D_86', 'D_87', 'R_17', 'R_18', 'B_31', 'S_19', 'R_19', 'B_32', 'S_20', 'R_20', 'R_21', 'B_33', 'D_89', 'R_22', 'R_23', 'D_91', 'D_92', 'D_93', 'D_94', 'R_24', 'R_25', 'D_96', 'S_22', 'S_23', 'S_24', 'S_25', 'S_26', 'D_102', 'D_103', 'D_104', 'D_105', 'D_106', 'D_107', 'B_36', 'B_37', 'R_26', 'R_27', 'B_38', 'D_108', 'D_109', 'D_111', 'D_112', 'B_40', 'S_27', 'D_113', 'D_114', 'D_115', 'D_116', 'D_117', 'D_118', 'D_119', 'D_120', 'D_121', 'D_122', 'D_123', 'D_124', 'D_125', 'D_126', 'D_127', 'D_128', 'D_129', 'B_41', 'D_130', 'D_131', 'D_133', 'R_28', 'D_135', 'D_136', 'D_137', 'D_138', 'D_139', 'D_140', 'D_141', 'D_143', 'D_144', 'D_145'])


if st.button("🕵️‍♂️ CatBoost Model"):
    fraud = CatBoostmodel.predict(values)
    if fraud==0:
        st.success(f"The current transaction can be classified as fraud which means this Customer ID can DEFAULT in the future.")
    else:
        st.success(f"The current transaction cannot be classified as fraud which means this Customer ID will Not DEFAULT in the future.")
    #st.success(f"The current transaction can be classified as {fraud} which means this Customer ID can DEFAULT in the future.")


if st.button("🕵️‍♂️ XGBoost Model"):
    fraud = XGBoostmodel.predict(values)
    if fraud==0:
        st.success(f"The current transaction can be classified as fraud which means this Customer ID can DEFAULT in the future.")
    else:
        st.success(f"The current transaction cannot be classified as fraud which means this Customer ID will Not DEFAULT in the future.")
